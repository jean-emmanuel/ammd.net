<!-- exporter_csv -->




#SET{amaps, #ARRAY}
<BOUCLE_amap(AMAPS)>
    #SET{amaps, #GET{amaps}|array_merge{#ARRAY{#ID_AMAP, #NOM}}}
</BOUCLE_amap>



#SET{head, #ARRAY}
#SET{data, #ARRAY}
<BOUCLE_adherents(ADHERENTS)>

    #SET{line, #ARRAY}
    <BOUCLE_keys(DATA){source table, #VAL{spip_adherents}|sql_showtable|table_valeur{field}}>
    [(#CLE|match{id_adherent|maj}|non)

        [(#_adherents:COMPTEUR_BOUCLE|=={1}|oui)
            #SET{label, #VAL{champ_}|concat{#CLE}|concat{_label}}
            [(#CLE|=={id_amap}|oui)
                [(#SET{label, Amap})]
            ][(#CLE|=={id_amap}|non)
                [(#SET{label, #VAL{adherent:champ_}|concat{#CLE}|concat{_label}|_T})]
            ]
            #SET{head, #GET{head}|push{#GET{label}}}


        ]

        #SET{value, #CLE|sql_getfetsel{spip_adherents, #VAL{id_adherent=}|concat{#ID_ADHERENT}}}

        [(#CLE|match{date}||oui)
            [(#GET{value}|affdate|=={0}|?{
                #SET{value, ""},
                #SET{value, #GET{value}|affdate{d/m/Y}}
            })]
        ]

        [(#CLE|match{id_amap}|oui)
            #SET{value, #GET{amaps}|table_valeur{#GET{value}|moins{1}}}
        ]

        [(#CLE|match{telephone}|oui)
            #SET{value, #GET{value}||concat{" "}}
        ]

        #SET{line, #GET{line}|push{#GET{value}}}

    ]
    </BOUCLE_keys>
    #SET{data, #GET{data}|push{#GET{line}}}

</BOUCLE_adherents>


_: [(#GET{head}|print)]
[(#GET{data}|print)]

[(#REM)
[(#VAL{test}|export_csv{#GET{data}, ',', #GET{head}, 0}|readfile|table_valeur{0})]
]
